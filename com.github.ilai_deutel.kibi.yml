app-id: com.github.ilai_deutel.kibi

runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable

command: kibi

rename-desktop-file: kibi.desktop
rename-icon: logo

build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/kibi/cargo

finish-args:
  - --filesystem=host
  - --filesystem=/tmp
  - --filesystem=/var/tmp

modules:
  - name: kibi
    buildsystem: simple
    build-commands:
      - cargo --offline fetch --manifest-path 'Cargo.toml' --verbose
      - cargo --offline build --release --locked --verbose
      - install -Dm755 'target/release/kibi' --target-directory '/app/bin'
      - install -Dm644 'config_example.ini' '/app/etc/kibi/config.ini'
      - install -Dm644 syntax.d/* -t '/app/share/kibi/syntax.d'
      - install -Dm644 'kibi.desktop' -t '/app/share/applications'
      - install -Dm644 'com.github.ilai_deutel.kibi.metainfo.xml' -t '/app/share/metainfo/'
      - install -Dm644 'assets/logo.svg' -t '/app/share/icons/hicolor/scalable/apps/'
    test-commands:
      - cargo --offline test --release --locked --verbose
    sources:
      - cargo-sources.json
      - type: archive
        url: https://github.com/ilai-deutel/kibi/archive/v0.3.1/kibi-0.3.1.tar.gz
        sha256: 2905743c8fc065054d3776e9b16fe89903cc0547eaedd8d33b66d2e29ceb0191
      - type: file
        path: com.github.ilai_deutel.kibi.metainfo.xml
      - type: patch
        path: kibi.desktop.patch
      - type: patch
        path: Cargo.toml.patch
